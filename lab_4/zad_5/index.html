<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    .section-container{
        display: flex;
        justify-content: center;
        align-items: center;
        height: 50vh;
        border: 2px solid black;
    }

    #menu{
        background-color: orange;
        position: sticky;
        top: 0;
        padding: 10px;
        border: 5px solid lightblue;
    }
</style>
<body>
    <div id="menu">
        <h2>MENU: </h2>
    </div>
    <div id="container"></div>
    <div>
        <h2 style="font-size: 5rem">Thats all there is...</h2>
    </div>
    
</body>
<script>
    const container = document.getElementById("container")
    const menu = document.getElementById("menu")

    const sections = []
    const maxSections = 9 // we count from 0 so its 10 in total

    let observer = null

    const init = async () => {
        await addSectionAndObserver(0)
    }

    const addSectionAndObserver = async (sectionNumber) => {
        const section = await fetchSection(sectionNumber)

        sections.push(section)

        const div = document.createElement("div")
        div.classList.add("section-container")
    
        div.innerHTML = 
        `<div>
            <h2>${section.title}</h2>
            <img src=${section.image}>
            <p>${section.text}</p>
        </div>`

        container.appendChild(div)
        addTextToMenu(sections.length + ": " + section.title)

        addObserverToLastSection()
    }

    const fetchSection = async (number) => {
        const response = await fetch(`sections/${number}.json`)

        return await response.json()
    }

    const addTextToMenu = (text) => {
        const p = document.createElement("p")
        p.textContent = text

        menu.appendChild(p)
    }

    const addObserverToLastSection = () => {
        const allSections = Array.from(document.getElementsByClassName("section-container"));

        if(observer){
            observer.disconnect();
        }

        observer = new IntersectionObserver(
            (entries) => {
                entries.forEach(async (entry) => {
                    if (entry.isIntersecting && allSections.length <= maxSections) {
                        await addSectionAndObserver(allSections.length)
                    }
                });
            },
            { threshold: 0.8 }
        );
        observer.observe(allSections[allSections.length - 1])
    }

    init()

</script>
</html>