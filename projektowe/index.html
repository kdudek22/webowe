<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Blockout 3D – kamera myszką</title>
<style>
    body { margin: 0; background: #000; overflow: hidden; color: white; }
    #info {
        position: absolute;
        top: 10px;
        width: 100%;
        text-align: center;
        font-family: Arial;
        z-index: 1;
    }
</style>
</head>
<body>

<div id="info">
Mysz – obrót kamery | Scroll – zoom<br>
⬅️ ➡️ ⬆️ ⬇️ ruch | A/D rotacja | Spacja – drop
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.145/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.145/examples/js/controls/OrbitControls.js"></script>

<script type="module">

/* SCENA */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

/* KAMERA */
const camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(8,8,14);

/* RENDERER */
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

/* ORBIT CONTROLS */
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.target.set(0,0,-10);
controls.enableDamping = true;
controls.dampingFactor = 0.05;
controls.enablePan = false;
controls.minDistance = 6;
controls.maxDistance = 30;
controls.maxPolarAngle = Math.PI / 2.1;

/* RESIZE */
window.addEventListener("resize",()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});

/* LIGHT */
scene.add(new THREE.AmbientLight(0x444444));
const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,10,5);
scene.add(light);

/* STUDNIA */
const WELL_SIZE = 6;
const WELL_DEPTH = 20;
const wellGeo = new THREE.BoxGeometry(WELL_SIZE, WELL_SIZE, WELL_DEPTH);
const wellWire = new THREE.EdgesGeometry(wellGeo);
const well = new THREE.LineSegments(
    wellWire,
    new THREE.LineBasicMaterial({color: 0x00ffff})
);
well.position.z = -WELL_DEPTH/2;
scene.add(well);

/* BRYŁY */
const cubeGeo = new THREE.BoxGeometry(1,1,1);
const cubeMat = new THREE.MeshStandardMaterial({color: 0xff4444});

let activePiece;
const fixedPieces = [];

function createPiece() {
    const g = new THREE.Group();
    const shape = [
        [0,0,0],
        [1,0,0],
        [0,1,0]
    ];
    shape.forEach(p=>{
        const c = new THREE.Mesh(cubeGeo, cubeMat);
        c.position.set(p[0],p[1],p[2]);
        g.add(c);
    });
    g.position.set(0,0,0);
    scene.add(g);
    return g;
}

function spawnPiece() {
    activePiece = createPiece();
}

spawnPiece();

/* CONTROLS FOR PIECE */
let speed = 0.03;
document.addEventListener("keydown", e=>{
    if(!activePiece) return;
    if(e.key==="ArrowLeft") activePiece.position.x -= 1;
    if(e.key==="ArrowRight") activePiece.position.x += 1;
    if(e.key==="ArrowUp") activePiece.position.y += 1;
    if(e.key==="ArrowDown") activePiece.position.y -= 1;
    if(e.key==="a") activePiece.rotation.z += Math.PI/2;
    if(e.key==="d") activePiece.rotation.z -= Math.PI/2;
    if(e.key===" ") speed = 0.2;
});

/* FIX PIECE */
function fixPiece() {
    fixedPieces.push(activePiece);
    activePiece = null;
    speed = 0.03;
    spawnPiece();
}

/* ANIMATE */
function animate() {
    requestAnimationFrame(animate);

    if(activePiece) {
        activePiece.position.z -= speed;
        if(activePiece.position.z <= -WELL_DEPTH + 1) {
            activePiece.position.z = -WELL_DEPTH + 1;
            fixPiece();
        }
    }

    controls.update();
    renderer.render(scene, camera);
}

animate();
</script>


</body>
</html>
